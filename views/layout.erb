<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Meme Explorer üòé</title>
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Comic Neue', cursive; margin:0; background:#fefefe; transition:0.5s; }
  header { background:linear-gradient(90deg,#ff8a00,#e52e71); color:#fff; padding:20px; text-align:center; position:sticky; top:0; z-index:100; }
  header nav { display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-top:10px; }
  header nav a { background: rgba(255,255,255,0.15); color:#fff; padding:8px 14px; border-radius:8px; font-weight:600; text-decoration:none; transition:0.2s; }
  header nav a:hover { background: rgba(255,255,255,0.35); transform: translateY(-2px);}
  main { max-width:1100px; margin:0 auto; padding:20px;}
  footer { text-align:center; padding:20px; background:#333; color:#fff;}
  form { text-align:center; margin:20px 0;}
  form input[type=text]{padding:10px;border-radius:12px 0 0 12px;border:1px solid #ccc;width:260px;}
  form button{padding:10px 16px;border:none;border-radius:0 12px 12px 0;background:#e52e71;color:#fff;cursor:pointer;}
</style>
</head>
<body>
<header>
  <h1><a href="/" style="color:white;text-decoration:none;">Meme Explorer üòé</a></h1>
  <nav>
    <a href="/category/funny">Funny</a>
    <a href="/category/wholesome">Wholesome</a>
    <a href="/category/dank">Dank</a>
    <a href="/category/selfcare">Self Care</a>
    <a href="/trending">Trending</a>
    <a href="/metrics">üìà Metrics</a>
    <a href="/random">Random üé≤</a>
  </nav>
</header>

<form action="/search" method="get">
  <input type="text" name="q" placeholder="Search memes..." value="<%= params[:q] %>">
  <button>Search</button>
</form>

<main>
  <%= yield %>
</main>

<footer>
  <p>Built with ‚ù§Ô∏è using Sinatra</p>
</footer>
</body>
</html>
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll("form.like-form").forEach(form => {
    form.addEventListener("submit", async e => {
      e.preventDefault();

      const button = form.querySelector("button");
      const url = form.querySelector("input[name='url']").value;
      const likesSpan = form.closest(".meme-container").querySelector("#meme-likes");

      try {
        const res = await fetch(form.action, {
          method: "POST",
          body: new URLSearchParams(new FormData(form)),
          headers: { "Accept": "application/json" }
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.error || "Request failed");

        // Update button & likes
        if (data.liked) {
          button.textContent = "üíî Unlike";
          button.classList.add("liked");
        } else {
          button.textContent = "‚ù§Ô∏è Like";
          button.classList.remove("liked");
        }

        if (likesSpan) likesSpan.textContent = data.likes;

      } catch (err) {
        console.error("Like AJAX error:", err);
      }
    });
  });
});
</script>
