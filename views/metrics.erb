<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Meme Metrics Dashboard</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 2rem; 
      background: #f4f4f9; 
      color: #333; 
    }

    h1, h2 { 
      color: #222; 
    }

    .metrics { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 1rem; 
      margin-bottom: 2rem; 
    }

    .metric { 
      background: #fff; 
      padding: 1rem; 
      flex: 1 1 200px; 
      box-shadow: 0 0 5px rgba(0,0,0,0.1); 
      border-radius: 5px; 
      text-align: center;
      transition: transform 0.2s ease;
    }

    .metric:hover { 
      transform: translateY(-3px); 
      box-shadow: 0 5px 10px rgba(0,0,0,0.15);
    }

    .metric h3 { 
      margin: 0 0 0.5rem 0; 
      font-size: 1rem; 
      color: #555; 
    }

    .metric p { 
      font-size: 1.5rem; 
      margin: 0; 
      color: #111; 
    }

    table { 
      border-collapse: collapse; 
      width: 100%; 
      margin-bottom: 2rem; 
      background: #fff; 
      box-shadow: 0 0 5px rgba(0,0,0,0.1); 
    }

    th, td { 
      border: 1px solid #ccc; 
      padding: 0.5rem; 
      text-align: left; 
    }

    th { 
      background: #eee; 
    }

    a { 
      color: #1e88e5; 
      text-decoration: none; 
    }

    a:hover { 
      text-decoration: underline; 
    }

    .no-data {
      text-align: center;
      font-style: italic;
      color: #888;
    }
  </style>
</head>
<body>
  <h1>Meme Metrics Dashboard</h1>

  <div class="metrics">
    <div class="metric">
      <h3>Total Memes</h3>
      <p><%= @total_memes %></p>
    </div>
    <div class="metric">
      <h3>Total Likes</h3>
      <p><%= @total_likes %></p>
    </div>
    <div class="metric">
      <h3>Total Views</h3>
      <p><%= @total_views %></p>
    </div>
    <div class="metric">
      <h3>Average Likes</h3>
      <p><%= @avg_likes %></p>
    </div>
    <div class="metric">
      <h3>Average Views</h3>
      <p><%= @avg_views %></p>
    </div>
    <div class="metric">
      <h3>Memes with No Likes</h3>
      <p><%= @memes_with_no_likes %></p>
    </div>
    <div class="metric">
      <h3>Memes with No Views</h3>
      <p><%= @memes_with_no_views %></p>
    </div>
    <div class="metric">
      <h3>Redis Likes</h3>
      <p><%= @redis_likes %></p>
    </div>
    <div class="metric">
      <h3>Redis Views</h3>
      <p><%= @redis_views %></p>
    </div>
    <div class="metric">
      <h3>Redis No Likes</h3>
      <p><%= @redis_no_likes %></p>
    </div>
    <div class="metric">
      <h3>Redis No Views</h3>
      <p><%= @redis_no_views %></p>
    </div>
    <div class="metric">
      <h3>Avg Request Time (ms)</h3>
      <p><%= @avg_request_time_ms.round(2) %></p>
    </div>
    <div class="metric">
      <h3>Total Requests</h3>
      <p><%= @total_requests %></p>
    </div>
  </div>

  <h2>Top 10 Memes by Score</h2>
  <table>
    <thead>
      <tr>
        <th>Title</th>
        <th>Subreddit</th>
        <th>Likes</th>
        <th>Views</th>
        <th>URL</th>
      </tr>
    </thead>
    <tbody>
      <% if @top_memes.any? %>
        <% @top_memes.each do |m| %>
          <tr>
            <td><%= m["title"] || "Unknown" %></td>
            <td><%= m["subreddit"] || "Unknown" %></td>
            <td><%= m["likes"].to_i %></td>
            <td><%= m["views"].to_i %></td>
            <td><a href="<%= m["url"] || "#" %>" target="_blank">Link</a></td>
          </tr>
        <% end %>
      <% else %>
        <tr><td colspan="5" class="no-data">No meme data available</td></tr>
      <% end %>
    </tbody>
  </table>

  <h2>Top 10 Subreddits by Likes</h2>
  <table>
    <thead>
      <tr>
        <th>Subreddit</th>
        <th>Total Likes</th>
        <th>Memes Count</th>
      </tr>
    </thead>
    <tbody>
      <% if @top_subreddits.any? %>
        <% @top_subreddits.each do |s| %>
          <tr>
            <td><%= s["subreddit"] || "Unknown" %></td>
            <td><%= s["total_likes"].to_i %></td>
            <td><%= s["count"].to_i %></td>
          </tr>
        <% end %>
      <% else %>
        <tr><td colspan="3" class="no-data">No subreddit data available</td></tr>
      <% end %>
    </tbody>
  </table>
</body>
</html>
