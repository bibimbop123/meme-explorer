<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meme Metrics Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      padding: clamp(1rem, 5vw, 2rem);
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 { 
      color: white;
      font-size: clamp(1.8rem, 6vw, 2.5rem);
      margin-bottom: clamp(1.5rem, 5vw, 2rem);
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h2 { 
      color: white;
      font-size: clamp(1.3rem, 4vw, 1.8rem);
      margin-top: clamp(2rem, 6vw, 3rem);
      margin-bottom: clamp(1rem, 3vw, 1.5rem);
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    /* Metric Cards Grid */
    .metrics { 
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: clamp(0.75rem, 2vw, 1.25rem);
      margin-bottom: clamp(2rem, 6vw, 3rem);
    }

    .metric { 
      background: white;
      padding: clamp(1rem, 3vw, 1.5rem);
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      min-height: 140px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .metric:hover { 
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .metric h3 { 
      font-size: clamp(0.75rem, 2vw, 0.95rem);
      color: #666;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }

    .metric p { 
      font-size: clamp(1.3rem, 5vw, 2rem);
      color: #222;
      font-weight: 700;
      line-height: 1.2;
    }

    /* Color coding for different metric types */
    .metric.primary { border-left: 4px solid #667eea; }
    .metric.success { border-left: 4px solid #4caf50; }
    .metric.warning { border-left: 4px solid #ff9800; }
    .metric.danger { border-left: 4px solid #f44336; }

    /* Table to Card Layout */
    .table-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      overflow: hidden;
      margin-bottom: clamp(1.5rem, 5vw, 2.5rem);
    }

    table { 
      border-collapse: collapse; 
      width: 100%;
    }

    th, td { 
      padding: clamp(0.75rem, 2vw, 1rem);
      text-align: left;
      font-size: clamp(0.85rem, 1.5vw, 1rem);
    }

    th { 
      background: #f5f5f5;
      font-weight: 700;
      color: #333;
      border-bottom: 2px solid #ddd;
    }

    tr {
      border-bottom: 1px solid #eee;
      transition: background-color 0.2s ease;
    }

    tbody tr:hover {
      background-color: #f9f9f9;
    }

    a {
      color: #667eea;
      font-weight: 600;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      display: inline-block;
      min-height: 44px;
      min-width: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease;
    }

    a:hover {
      background-color: rgba(102, 126, 234, 0.1);
    }

    .no-data {
      text-align: center;
      padding: 2rem 1rem;
      color: #999;
      font-style: italic;
    }

    /* Mobile Responsive Adjustments */
    @media (max-width: 768px) {
      /* Table to Card Layout on Mobile */
      .table-container table {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        padding: 1rem;
      }

      .table-container thead {
        display: none;
      }

      .table-container tbody {
        display: grid;
        gap: 1rem;
      }

      .table-container tr {
        display: grid;
        grid-template-columns: 1fr;
        border: 1px solid #ddd;
        padding: 1rem;
        border-radius: 8px;
        background: white;
        margin-bottom: 0.5rem;
      }

      .table-container td {
        display: grid;
        grid-template-columns: 120px 1fr;
        padding: 0.5rem 0;
        border: none;
      }

      .table-container td:before {
        content: attr(data-label);
        font-weight: 700;
        color: #667eea;
        margin-right: 1rem;
      }

      .table-container td a {
        grid-column: 1 / -1;
        text-align: center;
        margin-top: 0.5rem;
      }

      .metrics {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .metrics {
        grid-template-columns: 1fr;
      }

      h1 {
        text-align: center;
      }

      h2 {
        text-align: center;
      }
    }

    @media (min-width: 1024px) {
      .metrics {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“Š Meme Metrics Dashboard</h1>

    <!-- Metrics Grid -->
    <div class="metrics">
      <div class="metric primary">
        <h3>Total Memes</h3>
        <p><%= @total_memes %></p>
      </div>
      <div class="metric success">
        <h3>Total Likes</h3>
        <p><%= @total_likes %></p>
      </div>
      <div class="metric primary">
        <h3>Total Views</h3>
        <p><%= @total_views %></p>
      </div>
      <div class="metric warning">
        <h3>Avg Likes</h3>
        <p><%= @avg_likes %></p>
      </div>
      <div class="metric warning">
        <h3>Avg Views</h3>
        <p><%= @avg_views %></p>
      </div>
      <div class="metric danger">
        <h3>No Likes</h3>
        <p><%= @memes_with_no_likes %></p>
      </div>
      <div class="metric danger">
        <h3>No Views</h3>
        <p><%= @memes_with_no_views %></p>
      </div>
      <div class="metric primary">
        <h3>Total Users</h3>
        <p><%= @total_users || 0 %></p>
      </div>
      <div class="metric success">
        <h3>Saved Memes</h3>
        <p><%= @total_saved_memes || 0 %></p>
      </div>
    </div>

    <!-- Top Memes Table -->
    <h2>ðŸ”¥ Top 10 Memes by Score</h2>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>Subreddit</th>
            <th>Likes</th>
            <th>Views</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% if @top_memes.any? %>
            <% @top_memes.each do |m| %>
              <tr>
                <td data-label="Title"><%= m["title"] || "Unknown" %></td>
                <td data-label="Subreddit">r/<%= m["subreddit"] || "Unknown" %></td>
                <td data-label="Likes"><strong><%= m["likes"].to_i %></strong></td>
                <td data-label="Views"><strong><%= m["views"].to_i %></strong></td>
                <td data-label="Action"><a href="<%= m["url"] || "#" %>" target="_blank">View â†’</a></td>
              </tr>
            <% end %>
          <% else %>
            <tr><td colspan="5" class="no-data">No meme data available</td></tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <!-- Top Subreddits Table -->
    <h2>ðŸ‘‘ Top 10 Subreddits by Likes</h2>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Subreddit</th>
            <th>Total Likes</th>
            <th>Memes Count</th>
          </tr>
        </thead>
        <tbody>
          <% if @top_subreddits.any? %>
            <% @top_subreddits.each do |s| %>
              <tr>
                <td data-label="Subreddit"><strong>r/<%= s["subreddit"] || "Unknown" %></strong></td>
                <td data-label="Total Likes"><%= s["total_likes"].to_i %></td>
                <td data-label="Memes Count"><%= s["count"].to_i %></td>
              </tr>
            <% end %>
          <% else %>
            <tr><td colspan="3" class="no-data">No subreddit data available</td></tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
